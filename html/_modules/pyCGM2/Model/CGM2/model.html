<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyCGM2.Model.CGM2.model &#8212; pyCGM2-API 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootswatch-3.3.6/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../index.html">
          pyCGM2-API</a>
        <span class="navbar-text navbar-version pull-left"><b>version 0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../../https://pycgm2.github.io/index.html">pyCGM2</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../concepts.html#nomenclature">Nomenclature</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../nexusApps.html">Nexus Applications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../normativeData.html">Gait normative datasets</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyCGM2.html">pyCGM2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyCGM2.Model.CGM2.html">pyCGM2.Model.CGM2 subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyCGM2.Processing.html">pyCGM2.Processing subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyCGM2.Report.html">pyCGM2.Report subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyCGM2.Signal.html">pyCGM2.Signal subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyCGM2.Math.html">pyCGM2.Math subpackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pyCGM2.Tools.html">pyCGM2.Tools subpackage</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for pyCGM2.Model.CGM2.model</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Jan 15 14:27:51 2015</span>
<span class="sd">@author: fleboeuf</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">btk</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">frame</span> <span class="k">as</span> <span class="nn">cfr</span>

<span class="kn">from</span>  <span class="nn">pyCGM2.Tools</span> <span class="k">import</span>  <span class="n">btkTools</span>
<span class="kn">from</span> <span class="nn">pyCGM2.Math</span> <span class="k">import</span>  <span class="n">derivation</span>

<span class="kn">import</span> <span class="nn">pyCGM2.Signal.signal_processing</span> <span class="k">as</span> <span class="nn">pyCGM2signal</span> 



<span class="c1"># -------- ABSTRACT MODEL ---------</span>

<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract class `Model`.</span>
<span class="sd">        `Model` collects *segments*, *joints*, *body segment parameters* and present convenient model-componant accessors</span>

<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_jointCollection</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mp_computed</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_chains</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Basis Model&quot;</span>        

<div class="viewcode-block" id="Model.addChain"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.addChain">[docs]</a>    <span class="k">def</span> <span class="nf">addChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">indexSegmentList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Add a segment chain</span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the chain</span>
<span class="sd">                - `indexSegmentList` (list of int) - index of segment</span>
<span class="sd">                    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_chains</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">indexSegmentList</span></div>

<div class="viewcode-block" id="Model.addJoint"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.addJoint">[docs]</a>    <span class="k">def</span> <span class="nf">addJoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">proxLabel</span><span class="p">,</span> <span class="n">distLabel</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Add a joint</span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the chain</span>
<span class="sd">                - `proxLabel` (str) - label of the proximal segment</span>
<span class="sd">                - `distLabel` (str) - label of the distal segment</span>
<span class="sd">                - `sequence` (str) - sequence angle</span>
<span class="sd">                    </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">j</span><span class="o">=</span><span class="n">Joint</span><span class="p">(</span> <span class="n">label</span><span class="p">,</span> <span class="n">proxLabel</span><span class="p">,</span><span class="n">distLabel</span><span class="p">,</span><span class="n">sequence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_jointCollection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model.addSegment"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.addSegment">[docs]</a>    <span class="k">def</span> <span class="nf">addSegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">sideEnum</span><span class="p">,</span> <span class="n">lst_markerlabel</span><span class="o">=</span><span class="p">[],</span> <span class="n">tracking_markers</span><span class="o">=</span><span class="p">[],):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Add a segment</span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the segment</span>
<span class="sd">                - `index` (str) - index of the segment</span>
<span class="sd">                - `sideEnum` (pyCGM2.enums) - body side</span>
<span class="sd">                - `lst_markerlabel` (list of str) - sequence angle</span>
<span class="sd">                - `tracking_markers` (list of str) - sequence angle</span>
<span class="sd">                    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">s</span><span class="o">=</span><span class="n">Segment</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">sideEnum</span><span class="p">,</span><span class="n">lst_markerlabel</span><span class="p">,</span><span class="n">tracking_markers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>


<div class="viewcode-block" id="Model.updateSegmentFromCopy"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.updateSegmentFromCopy">[docs]</a>    <span class="k">def</span> <span class="nf">updateSegmentFromCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">targetLabel</span><span class="p">,</span> <span class="n">segmentToCopy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Update a segment from a copy of  another segment instance </span>

<span class="sd">            :Parameters:</span>
<span class="sd">                - `targetLabel` (str) - label of the segment</span>
<span class="sd">                - `segmentToCopy` (pyCGM2.Model.CGM2.model.Segment) - pyCGM2.Model.CGM2.model.Segment instance</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copiedSegment</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">segmentToCopy</span><span class="p">)</span>
        <span class="n">copiedSegment</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">targetLabel</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">targetLabel</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">copiedSegment</span></div>


<div class="viewcode-block" id="Model.getSegment"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.getSegment">[docs]</a>    <span class="k">def</span> <span class="nf">getSegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Get `Segment` from its label</span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the Segment </span>
<span class="sd">                      </span>
<span class="sd">            :Return:</span>
<span class="sd">                - `na` (pyCGM2.Model.CGM2.model.Segment) - pyCGM2.Model.CGM2.model.Segment instance</span>
<span class="sd">            </span>

<span class="sd">        &quot;&quot;&quot;</span>        

        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">it</span></div>

<div class="viewcode-block" id="Model.getSegmentIndex"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.getSegmentIndex">[docs]</a>    <span class="k">def</span> <span class="nf">getSegmentIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Get Segment index</span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the Segment </span>
<span class="sd">                      </span>
<span class="sd">            :Return:</span>
<span class="sd">                - `na` (int) - index</span>
<span class="sd">            </span>

<span class="sd">        &quot;&quot;&quot;</span>         
        <span class="n">index</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">index</span>
            <span class="n">index</span><span class="o">+=</span><span class="mi">1</span></div>


<div class="viewcode-block" id="Model.getSegmentByIndex"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.getSegmentByIndex">[docs]</a>    <span class="k">def</span> <span class="nf">getSegmentByIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Get `Segment` from its index</span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `index` (int) - index of the Segment </span>
<span class="sd">                      </span>
<span class="sd">            :Return:</span>
<span class="sd">                - `na` (pyCGM2.Model.CGM2.model.Segment) - pyCGM2.Model.CGM2.model.Segment instance</span>
<span class="sd">            </span>

<span class="sd">        &quot;&quot;&quot;</span>         

        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">it</span></div>



<div class="viewcode-block" id="Model.getJoint"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.getJoint">[docs]</a>    <span class="k">def</span> <span class="nf">getJoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Get `Joint` from its label</span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the joint </span>
<span class="sd">                      </span>
<span class="sd">            :Return:</span>
<span class="sd">                - `na` (pyCGM2.Model.CGM2.model.Joint) - pyCGM2.Model.CGM2.model.Joint instance</span>
<span class="sd">            </span>

<span class="sd">        &quot;&quot;&quot;</span>       

        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_jointCollection</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">m_label</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">it</span></div>

<div class="viewcode-block" id="Model.addAnthropoInputParameters"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.addAnthropoInputParameters">[docs]</a>    <span class="k">def</span> <span class="nf">addAnthropoInputParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">iDict</span><span class="p">,</span><span class="n">optional</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Add measured anthropometric data to the model  </span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">               - `iDict` (dict) - requried anthropometric data</span>
<span class="sd">               - `optionalMp` (dict) - optional anthropometric data</span>
<span class="sd">                      </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="o">=</span><span class="n">iDict</span>
        
        <span class="k">if</span> <span class="n">optional</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optional</span><span class="p">)</span></div>
            
        


        
        
<div class="viewcode-block" id="Model.decomposeTrackingMarkers"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Model.decomposeTrackingMarkers">[docs]</a>    <span class="k">def</span> <span class="nf">decomposeTrackingMarkers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">acq</span><span class="p">,</span><span class="n">TechnicalFrameLabel</span><span class="p">):</span>

    <span class="c1">#        decompose marker and keep a noisy signal along one axis only.</span>
    <span class="c1">#</span>
    <span class="c1">#        :Parameters:</span>
    <span class="c1">#         - `acq` (btk-acq) - </span>
    <span class="c1">#         - `TechnicalFrameLabel` (str) - label of the technical Frame</span>
    <span class="c1">#         </span>
    <span class="c1">#        .. todo:: </span>
    <span class="c1">#        </span>
    <span class="c1">#         - comment travailler avec des referentiels techniques differents par segment</span>
    <span class="c1">#         - rajouter des exceptions</span>

        
        <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_segmentCollection</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">m_tracking_markers</span><span class="p">:</span>
    
                <span class="n">nodeTraj</span><span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="n">getReferential</span><span class="p">(</span><span class="n">TechnicalFrameLabel</span><span class="p">)</span><span class="o">.</span><span class="n">getNodeTrajectory</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>            
                <span class="n">markersTraj</span> <span class="o">=</span><span class="n">acq</span><span class="o">.</span><span class="n">GetPoint</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span><span class="o">.</span><span class="n">GetValues</span><span class="p">()</span>        
                
                <span class="n">markerTrajectoryX</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">markersTraj</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodeTraj</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">nodeTraj</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
                <span class="n">markerTrajectoryY</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">nodeTraj</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">markersTraj</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">nodeTraj</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
                <span class="n">markerTrajectoryZ</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">nodeTraj</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodeTraj</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">markersTraj</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
                
                
                <span class="n">btkTools</span><span class="o">.</span><span class="n">smartAppendPoint</span><span class="p">(</span><span class="n">acq</span><span class="p">,</span><span class="n">marker</span><span class="o">+</span><span class="s2">&quot;-X&quot;</span><span class="p">,</span><span class="n">markerTrajectoryX</span><span class="p">,</span><span class="n">PointType</span><span class="o">=</span><span class="n">btk</span><span class="o">.</span><span class="n">btkPoint</span><span class="o">.</span><span class="n">Marker</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>            
                <span class="n">btkTools</span><span class="o">.</span><span class="n">smartAppendPoint</span><span class="p">(</span><span class="n">acq</span><span class="p">,</span><span class="n">marker</span><span class="o">+</span><span class="s2">&quot;-Y&quot;</span><span class="p">,</span><span class="n">markerTrajectoryY</span><span class="p">,</span><span class="n">PointType</span><span class="o">=</span><span class="n">btk</span><span class="o">.</span><span class="n">btkPoint</span><span class="o">.</span><span class="n">Marker</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>            
                <span class="n">btkTools</span><span class="o">.</span><span class="n">smartAppendPoint</span><span class="p">(</span><span class="n">acq</span><span class="p">,</span><span class="n">marker</span><span class="o">+</span><span class="s2">&quot;-Z&quot;</span><span class="p">,</span><span class="n">markerTrajectoryZ</span><span class="p">,</span><span class="n">PointType</span><span class="o">=</span><span class="n">btk</span><span class="o">.</span><span class="n">btkPoint</span><span class="o">.</span><span class="n">Marker</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>            </div></div>



        


<span class="c1"># --------  MODEL COMPONANTS ---------        </span>
<div class="viewcode-block" id="Referential"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Referential">[docs]</a><span class="k">class</span> <span class="nc">Referential</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         A `Referential` is a coordinate system</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="o">=</span><span class="n">cfr</span><span class="o">.</span><span class="n">Frame</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relativeMatrixAnatomic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>         

<div class="viewcode-block" id="Referential.setStaticFrame"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Referential.setStaticFrame">[docs]</a>    <span class="k">def</span> <span class="nf">setStaticFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set a `Frame` to the member Static of the `Referential`</span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `Frame` (pyCGM2.Model.CGM2.frame.Frame) - pyCGM2-Frame instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static</span> <span class="o">=</span> <span class="n">Frame</span></div>


<div class="viewcode-block" id="Referential.addMotionFrame"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Referential.addMotionFrame">[docs]</a>    <span class="k">def</span> <span class="nf">addMotionFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">             Add a `Frame` to the motion member of the `Referential`</span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `Frame` (pyCGM2.Model.CGM2.frame.Frame) - pyCGM2-Frame instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Frame</span><span class="p">)</span></div>

<div class="viewcode-block" id="Referential.getNodeTrajectory"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Referential.getNodeTrajectory">[docs]</a>    <span class="k">def</span> <span class="nf">getNodeTrajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Get trajectory of a node        </span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the desired node </span>

<span class="sd">            :Return: </span>
<span class="sd">                - `pt` (numpy.array(:,3)) - values of the global point trajectory   </span>

<span class="sd">        &quot;&quot;&quot;</span>        

        <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="o">.</span><span class="n">getNode_byLabel</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">nFrames</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">)</span>        
        <span class="n">pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFrames</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nFrames</span><span class="p">):</span>
            <span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getRotation</span><span class="p">(),</span><span class="n">node</span><span class="o">.</span><span class="n">m_local</span><span class="p">)</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getTranslation</span><span class="p">()</span>            
        
        <span class="k">return</span> <span class="n">pt</span> </div></div>



<div class="viewcode-block" id="TechnicalReferential"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.TechnicalReferential">[docs]</a><span class="k">class</span> <span class="nc">TechnicalReferential</span><span class="p">(</span><span class="n">Referential</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A `TechnicalReferential` inherit from `Referential`. This specification defines a *Technical* Coordinate system of the segment </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the technical referential</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO - By labelling a technical referential, the code accepts multi-technical referentials per Segment. This feature should be removed </span>
        
        
        <span class="nb">super</span><span class="p">(</span><span class="n">TechnicalReferential</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">=</span><span class="n">label</span>


<div class="viewcode-block" id="TechnicalReferential.setRelativeMatrixAnatomic"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.TechnicalReferential.setRelativeMatrixAnatomic">[docs]</a>    <span class="k">def</span> <span class="nf">setRelativeMatrixAnatomic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Set the relative rigid rotation of the anatomical Referential expressed in the technical referential (:math:`R^a_t`). </span>
<span class="sd">                    </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `array` (numpy.array(3,3) - rigid rotation        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relativeMatrixAnatomic</span> <span class="o">=</span> <span class="n">array</span></div></div>

<div class="viewcode-block" id="AnatomicalReferential"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.AnatomicalReferential">[docs]</a><span class="k">class</span> <span class="nc">AnatomicalReferential</span><span class="p">(</span><span class="n">Referential</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A `AnatomicalReferential` inherit from `Referential`. This specification defines the *Anatomical* Coordinate system of a segment </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AnatomicalReferential</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span></div>





<div class="viewcode-block" id="Segment"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment">[docs]</a><span class="k">class</span> <span class="nc">Segment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        A Segment defines a solid composing of the model         </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1">#TODO</span>
    <span class="c1">#       Referential doesn&#39;t distinguish anatomical frame  from technical frame</span>
    <span class="c1">#       used only for tracking gait and/or functional calibration</span>
    <span class="c1"># </span>
    <span class="c1">#       compute constant matrix rotation between each referential.static      </span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">sideEnum</span> <span class="p">,</span><span class="n">lst_markerlabel</span><span class="o">=</span><span class="p">[],</span> <span class="n">tracking_markers</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the segment</span>
<span class="sd">                - `index` (str) - index of the segment</span>
<span class="sd">                - `sideEnum` (pyCGM2.enums) - body side</span>
<span class="sd">                - `lst_markerlabel` (list of str) - sequence angle</span>
<span class="sd">                - `tracking_markers` (list of str) - sequence angle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">side</span> <span class="o">=</span> <span class="n">sideEnum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_markerLabels</span><span class="o">=</span><span class="n">lst_markerlabel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_tracking_markers</span><span class="o">=</span><span class="n">tracking_markers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">referentials</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span> <span class="o">=</span><span class="n">AnatomicalReferential</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>                
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;rog&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;com&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">))</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;inertia&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">m_externalDeviceWrenchs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_externalDeviceBtkWrench</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalWrench</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;internal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;external&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;inertia&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;linearAcceleration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;gravity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;externalDevices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;distalSegments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;distalSegmentForces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalMomentContribution</span><span class="p">[</span><span class="s2">&quot;distalSegmentMoments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="Segment.zeroingExternalDevice"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.zeroingExternalDevice">[docs]</a>    <span class="k">def</span> <span class="nf">zeroingExternalDevice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Zeroing external device wrench</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_externalDeviceWrenchs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_externalDeviceBtkWrench</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Segment.zeroingProximalWrench"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.zeroingProximalWrench">[docs]</a>    <span class="k">def</span> <span class="nf">zeroingProximalWrench</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Zeroing proximal wrench</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalWrench</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Segment.downSampleExternalDeviceWrenchs"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.downSampleExternalDeviceWrenchs">[docs]</a>    <span class="k">def</span> <span class="nf">downSampleExternalDeviceWrenchs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">appf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Downsample external device wrenchs</span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `appf` (int) - analog point per frame</span>
<span class="sd">        &quot;&quot;&quot;</span>                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isExternalDeviceWrenchsConnected</span><span class="p">():</span>        
            
            <span class="k">for</span> <span class="n">wrIt</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_externalDeviceWrenchs</span><span class="p">:</span>
                <span class="n">forceValues</span> <span class="o">=</span> <span class="n">wrIt</span><span class="o">.</span><span class="n">GetForce</span><span class="p">()</span><span class="o">.</span><span class="n">GetValues</span><span class="p">()</span>
                <span class="n">forceValues_ds</span><span class="o">=</span> <span class="n">forceValues</span><span class="p">[::</span><span class="n">appf</span><span class="p">]</span>
                <span class="n">wrIt</span><span class="o">.</span><span class="n">GetForce</span><span class="p">()</span><span class="o">.</span><span class="n">SetValues</span><span class="p">(</span><span class="n">forceValues_ds</span><span class="p">)</span>
                
                <span class="n">momentValues</span> <span class="o">=</span> <span class="n">wrIt</span><span class="o">.</span><span class="n">GetMoment</span><span class="p">()</span><span class="o">.</span><span class="n">GetValues</span><span class="p">()</span>
                <span class="n">momentValues_ds</span><span class="o">=</span> <span class="n">momentValues</span><span class="p">[::</span><span class="n">appf</span><span class="p">]</span>
                <span class="n">wrIt</span><span class="o">.</span><span class="n">GetMoment</span><span class="p">()</span><span class="o">.</span><span class="n">SetValues</span><span class="p">(</span><span class="n">momentValues_ds</span><span class="p">)</span>

                <span class="n">positionValues</span> <span class="o">=</span> <span class="n">wrIt</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span><span class="o">.</span><span class="n">GetValues</span><span class="p">()</span>
                <span class="n">positionValues_ds</span><span class="o">=</span> <span class="n">positionValues</span><span class="p">[::</span><span class="n">appf</span><span class="p">]</span>
                <span class="n">wrIt</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span><span class="o">.</span><span class="n">SetValues</span><span class="p">(</span><span class="n">positionValues_ds</span><span class="p">)</span></div>
       

<div class="viewcode-block" id="Segment.isExternalDeviceWrenchsConnected"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.isExternalDeviceWrenchsConnected">[docs]</a>    <span class="k">def</span> <span class="nf">isExternalDeviceWrenchsConnected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Detect external device wrenchs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_externalDeviceWrenchs</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Segment.addExternalDeviceWrench"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.addExternalDeviceWrench">[docs]</a>    <span class="k">def</span> <span class="nf">addExternalDeviceWrench</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">btkWrench</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Add an external device wrench </span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `btkWrench` (btk.wrench) - a btk wrench instance            </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_externalDeviceWrenchs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btkWrench</span><span class="p">)</span></div>

   

<div class="viewcode-block" id="Segment.setMass"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.setMass">[docs]</a>    <span class="k">def</span> <span class="nf">setMass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set segment mass</span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `value` (float) - mass            </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>        </div>

<div class="viewcode-block" id="Segment.setLength"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.setLength">[docs]</a>    <span class="k">def</span> <span class="nf">setLength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set segment length</span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `value` (float) - length            </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>        </div>

<div class="viewcode-block" id="Segment.setRog"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.setRog">[docs]</a>    <span class="k">def</span> <span class="nf">setRog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set segment radius of giration</span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `value` (float) - radius of giration            </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;rog&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>        </div>

<div class="viewcode-block" id="Segment.setComPosition"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.setComPosition">[docs]</a>    <span class="k">def</span> <span class="nf">setComPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set local position of the centre of mass </span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `array3` (numpy.array(3,)) - centre of mass position            </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;com&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array3</span>        </div>

<div class="viewcode-block" id="Segment.setInertiaTensor"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.setInertiaTensor">[docs]</a>    <span class="k">def</span> <span class="nf">setInertiaTensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array33</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Set segment inertia tensor </span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `array33` (numpy.array(3,3)) - tensor of inertia           </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;inertia&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">array33</span>        </div>


<div class="viewcode-block" id="Segment.addMarkerLabel"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.addMarkerLabel">[docs]</a>    <span class="k">def</span> <span class="nf">addMarkerLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Add a marker </span>

<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - marker label  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">isFind</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_markerLabels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">marker</span><span class="p">:</span>
                <span class="n">isFind</span><span class="o">=</span><span class="kc">True</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">isFind</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;marker </span><span class="si">%s</span><span class="s2"> already in the marker segment list&quot;</span> <span class="o">%</span> <span class="n">label</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_markerLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Segment.addTrackingMarkerLabel"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.addTrackingMarkerLabel">[docs]</a>    <span class="k">def</span> <span class="nf">addTrackingMarkerLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Add a tracking marker </span>

<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - marker label  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">isFind</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_tracking_markers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">marker</span><span class="p">:</span>
                <span class="n">isFind</span><span class="o">=</span><span class="kc">True</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">isFind</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;marker </span><span class="si">%s</span><span class="s2"> already in the tracking marker segment list&quot;</span> <span class="o">%</span> <span class="n">label</span><span class="p">)</span> 

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_tracking_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></div>




<div class="viewcode-block" id="Segment.addTechnicalReferential"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.addTechnicalReferential">[docs]</a>    <span class="k">def</span> <span class="nf">addTechnicalReferential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Add a technical referential </span>
<span class="sd">            </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - technical frame label  </span>
<span class="sd">        &quot;&quot;&quot;</span>

  
        <span class="n">ref</span><span class="o">=</span><span class="n">TechnicalReferential</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">referentials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span></div>



<div class="viewcode-block" id="Segment.getReferential"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.getReferential">[docs]</a>    <span class="k">def</span> <span class="nf">getReferential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Access a referential from its label</span>

<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - technical referential label  </span>

<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="k">for</span> <span class="n">tfIt</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">referentials</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tfIt</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tfIt</span></div>
                        
    

<div class="viewcode-block" id="Segment.getComTrajectory"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.getComTrajectory">[docs]</a>    <span class="k">def</span> <span class="nf">getComTrajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exportBtkPoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">btkAcq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get global trajectory of the centre of mass        </span>

<span class="sd">            :Parameters:</span>
<span class="sd">                - `exportBtkPoint` (bool) - enable export as btk point</span>
<span class="sd">                - `btkAcq` (btk acquisition) - a btk acquisition instance</span>

<span class="sd">            :Return:</span>
<span class="sd">                - `values` (numpy.array(n,3)) - values of the com trajectory        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">frameNumber</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">)</span>         
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">frameNumber</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">frameNumber</span><span class="p">):</span>    
            <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getRotation</span><span class="p">()</span> <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">m_bsp</span><span class="p">[</span><span class="s2">&quot;com&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getTranslation</span><span class="p">()</span> 

        <span class="k">if</span> <span class="n">exportBtkPoint</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">btkAcq</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">btkTools</span><span class="o">.</span><span class="n">smartAppendPoint</span><span class="p">(</span><span class="n">btkAcq</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_com&quot;</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="Segment.getComVelocity"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.getComVelocity">[docs]</a>    <span class="k">def</span> <span class="nf">getComVelocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pointFrequency</span><span class="p">,</span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;spline&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get global linear velocity of the centre of mass        </span>

<span class="sd">            :Parameters:</span>
<span class="sd">                - `pointFrequency` (double) - point frequency</span>
<span class="sd">                - `method` (str) - derivation method (spline, spline fitting)</span>

<span class="sd">            :Return:</span>
<span class="sd">                - `values` (numpy.array(n,3)) - values of the com velocity            </span>
<span class="sd">            </span>
<span class="sd">            .. note :: if method doesnt recognize, numerical first order derivation is used </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>        
        
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;spline&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">derivation</span><span class="o">.</span><span class="n">splineDerivation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getComTrajectory</span><span class="p">(),</span><span class="n">pointFrequency</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;spline fitting&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">derivation</span><span class="o">.</span><span class="n">splineFittingDerivation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getComTrajectory</span><span class="p">(),</span><span class="n">pointFrequency</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">derivation</span><span class="o">.</span><span class="n">firstOrderFiniteDifference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getComTrajectory</span><span class="p">(),</span><span class="n">pointFrequency</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="Segment.getComAcceleration"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.getComAcceleration">[docs]</a>    <span class="k">def</span> <span class="nf">getComAcceleration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pointFrequency</span><span class="p">,</span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;spline&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get global linear acceleration of the centre of mass        </span>

<span class="sd">            :Parameters:</span>
<span class="sd">                - `pointFrequency` (double) - point frequency</span>
<span class="sd">                - `method` (str) - derivation method (spline, spline fitting)</span>
<span class="sd">                - `**options` (kwargs) - options pass to method. </span>
<span class="sd">            </span>
<span class="sd">            :Return:</span>
<span class="sd">                - `values` (numpy.array(n,3)) - values of the com acceleration</span>

<span class="sd">            .. attention :: com trajectory can be smoothed  by calling fc and order, the cut-off frequency and the order of the low-pass filter respectively  </span>

<span class="sd"> </span>
<span class="sd">            .. note :: </span>

<span class="sd">                if method doesnt recognize, numerical second order derivation is used </span>

<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span> 
        
        <span class="n">valueCom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getComTrajectory</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;fc&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span>  <span class="s2">&quot;order&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>        
            <span class="n">valueCom</span> <span class="o">=</span> <span class="n">pyCGM2signal</span><span class="o">.</span><span class="n">arrayLowPassFiltering</span><span class="p">(</span><span class="n">valueCom</span><span class="p">,</span><span class="n">pointFrequency</span><span class="p">,</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">],</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;fc&quot;</span><span class="p">]</span>  <span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;spline&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">derivation</span><span class="o">.</span><span class="n">splineDerivation</span><span class="p">(</span><span class="n">valueCom</span><span class="p">,</span><span class="n">pointFrequency</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;spline fitting&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">derivation</span><span class="o">.</span><span class="n">splineFittingDerivation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getComTrajectory</span><span class="p">(),</span><span class="n">pointFrequency</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">derivation</span><span class="o">.</span><span class="n">secondOrderFiniteDifference</span><span class="p">(</span><span class="n">valueCom</span><span class="p">,</span><span class="n">pointFrequency</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">values</span></div>

         



<div class="viewcode-block" id="Segment.getAngularVelocity"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.getAngularVelocity">[docs]</a>    <span class="k">def</span> <span class="nf">getAngularVelocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sampleFrequency</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;conventional&quot;</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Get angular velocity         </span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `sampleFrequency` (double) - point frequency</span>
<span class="sd">                - `method` (str) - method used for computing the angular velocity</span>

<span class="sd">            :Return:</span>
<span class="sd">                - `AngularVelocValues` (numpy.array(n,3)) - values of the angular velocity</span>
<span class="sd">                </span>
<span class="sd">            .. note::</span>
<span class="sd">                </span>
<span class="sd">                The *pig* method reproduce a  bodybuilder code of the plug-in gait.  </span>
<span class="sd">                </span>
<span class="sd">                .. raw:: python</span>

<span class="sd">                      AngVel = [ dot( NextPosR(:,2), PrevPosR(:,3) ); ...</span>
<span class="sd">                                 dot( NextPosR(:,3), PrevPosR(:,1) ); ...</span>
<span class="sd">                                 dot( NextPosR(:,1), PrevPosR(:,2) ); ...</span>
<span class="sd">                               ] ./ (2*SamplePeriod);</span>

<span class="sd">                The *conventional* method computes angular velocity through this statement :math:`\dot{R}R^t`   </span>

<span class="sd">        &quot;&quot;&quot;</span> 
 

        <span class="n">frameNumber</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">)</span>        
        <span class="n">AngularVelocValues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">frameNumber</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

        <span class="c1"># pig method0</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;pig&quot;</span><span class="p">:</span>  
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">frameNumber</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">omegaX</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">m_axisY</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">m_axisZ</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">sampleFrequency</span><span class="p">)</span>
                                          
                <span class="n">omegaY</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">m_axisZ</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">m_axisX</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">sampleFrequency</span><span class="p">)</span>
        
                <span class="n">omegaZ</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">m_axisX</span><span class="p">,</span> 
                                <span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">m_axisY</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">sampleFrequency</span><span class="p">)</span>
                                          
                <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">omegaX</span><span class="p">,</span><span class="n">omegaY</span><span class="p">,</span><span class="n">omegaZ</span><span class="p">]])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>                          
                
                <span class="n">AngularVelocValues</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getRotation</span><span class="p">(),</span>  <span class="n">omega</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    
        <span class="c1"># conventional method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;conventional&quot;</span><span class="p">:</span>  
            <span class="n">rdot</span> <span class="o">=</span> <span class="n">derivation</span><span class="o">.</span><span class="n">matrixFirstDerivation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">,</span> <span class="n">sampleFrequency</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">frameNumber</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rdot</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">anatomicalFrame</span><span class="o">.</span><span class="n">motion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">getRotation</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
                <span class="n">AngularVelocValues</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">AngularVelocValues</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">AngularVelocValues</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">AngularVelocValues</span>        </div>
        
        
<div class="viewcode-block" id="Segment.getAngularAcceleration"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Segment.getAngularAcceleration">[docs]</a>    <span class="k">def</span> <span class="nf">getAngularAcceleration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sampleFrequency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Get angular acceleration         </span>
<span class="sd">        </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `sampleFrequency` (double) - point frequency</span>
<span class="sd">            </span>
<span class="sd">            :Return:</span>
<span class="sd">                - `values` (numpy.array(n,3)) - values of the angular accelration</span>
<span class="sd">                </span>
<span class="sd">                </span>
<span class="sd">            .. note:: A first order differention of the angular velocity is used</span>
<span class="sd">        &quot;&quot;&quot;</span>        
                
        <span class="n">values</span> <span class="o">=</span> <span class="n">derivation</span><span class="o">.</span><span class="n">firstOrderFiniteDifference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAngularVelocity</span><span class="p">(</span><span class="n">sampleFrequency</span><span class="p">),</span><span class="n">sampleFrequency</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span></div></div>
             
<div class="viewcode-block" id="Joint"><a class="viewcode-back" href="../../../../pyCGM2.Model.CGM2.html#pyCGM2.Model.CGM2.model.Joint">[docs]</a><span class="k">class</span> <span class="nc">Joint</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a Joint defines relative motion between a proximal and a distal segment  </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">proxLabel</span><span class="p">,</span><span class="n">distLabel</span><span class="p">,</span><span class="n">sequence</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            :Parameters:</span>
<span class="sd">                - `label` (str) - label of the chain</span>
<span class="sd">                - `proxLabel` (str) - label of the proximal segment</span>
<span class="sd">                - `distLabel` (str) - label of the distal segment</span>
<span class="sd">                - `sequence` (str) - sequence angle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_label</span><span class="o">=</span><span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_proximalLabel</span><span class="o">=</span><span class="n">proxLabel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_distalLabel</span><span class="o">=</span><span class="n">distLabel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_sequence</span><span class="o">=</span><span class="n">sequence</span></div>
    
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Fabien Leboeuf.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>